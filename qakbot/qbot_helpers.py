import blzpack
from Crypto.Cipher import ARC4
import sys


brieflz_hdr = '\x62\x6C\x7A\x1A\x00\x00\x00\x01'
qbot_hdr = '\x61\x6c\xd3\x1a\x00\x00\x00\x01'

blocksize = 1024 * 1024

def qbot_decompress(data):
    return blzpack.decompress_data(brieflz_hdr.join(data.split(qbot_hdr)))

def qbot_decode(data):
    retval = ""
    rc4 = ARC4.new(data[:20])
    t = rc4.decrypt(data[20:])
    t = t[20:]
    if qbot_hdr not in t:
        retval = t
    else:
        retval = qbot_decompress(t)
    return retval


def main(data):
    return qbot_decompress(data)

if __name__ == "__main__":
    data = open(sys.argv[1], 'rb').read()
    data2 = qbot_decode(data)
    t = main(data2)
